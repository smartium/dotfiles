const assert = require('assert');
const i3wm = require('./i3wm')

const { Client } = i3wm

const Tests = {
  'encode message' () {
    assert(
      i3wm.encodeMessage(0, 'exit').toString('hex'),
      '69332d697063040000000000000065786974',
    );
  },

  async 'connect' () {
    await Client.connect()
  },

  async 'subscribe' (pass) {
    const client = await Client.connect()
    await client.subscribe('tick')

    client.on('tick', () => {
      pass()
    })

    client.message('send_tick')
  }
}

Object.entries(Tests).forEach(([test, handler]) => {
  const pass = () => {
    console.log(`${test} OK`);
  }
  const fail = (err) => {
    console.log(`${test} FAIL`)

    throw err
  }

  const args = handler.length > 0
        ? [pass]
        : []

  if (handler.length > 0) {
    Promise.resolve(handler(pass))
      .catch(fail);
  } else {
    Promise.resolve(handler())
      .then(pass, fail)
  }
})

console.log('\nAll tests passed!')
